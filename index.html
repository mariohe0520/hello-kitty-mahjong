<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>🎀 Hello Kitty 麻将</title>
<link rel="stylesheet" href="css/style.css?v=20260301-2">
<link rel="stylesheet" href="css/tiles.css?v=20260301-2">
<link rel="stylesheet" href="css/animations.css?v=20260301-2">
</head>
<body>

<!-- ===== SPLASH SCREEN ===== -->
<div id="splash" class="splash">
  <div class="splash-content">
    <div class="splash-logo">🎀</div>
    <h1 class="splash-title">Hello Kitty 麻将</h1>
    <p class="splash-sub">可爱又好玩的麻将世界</p>
    <div class="splash-loading">加载中...</div>
  </div>
</div>

<!-- ===== HOME PAGE ===== -->
<div id="home" class="page" style="display:none">
  <div id="home-content" class="page-scroll"></div>
</div>

<!-- ===== GAME TABLE ===== -->
<div id="game" class="page" style="display:none">
  <div class="game-topbar">
    <button class="icon-btn" onclick="App.backToMenu()">←</button>
    <div class="round-info">
      <span id="wind-indicator">东风</span>
      <span id="round-number">第1局</span>
    </div>
    <button class="icon-btn" onclick="App.toggleSettings()">⚙</button>
  </div>

  <div class="table-container">
    <div class="mahjong-table" id="mahjong-table">
      <!-- Top player (player 2) -->
      <div class="player-area player-top" id="player-top">
        <div class="player-label">
          <span class="player-avatar" id="avatar-top">🐻</span>
          <span class="player-name" id="name-top">对家</span>
          <span class="player-score" id="score-top">25000</span>
          <span class="player-wind" id="wind-top"></span>
          <span class="skill-cooldown" id="cooldown-top"></span>
        </div>
        <div class="hand hand-top" id="hand-top"></div>
        <div class="discard-river discard-river-top" id="discard-river-2"></div>
      </div>

      <div class="table-middle">
        <!-- Left player (player 3) -->
        <div class="player-area player-left" id="player-left">
          <div class="player-label">
            <span class="player-avatar" id="avatar-left">🐰</span>
            <span class="player-name" id="name-left">上家</span>
            <span class="player-score" id="score-left">25000</span>
            <span class="player-wind" id="wind-left"></span>
            <span class="skill-cooldown" id="cooldown-left"></span>
          </div>
          <div class="hand hand-side" id="hand-left"></div>
          <div class="discard-river discard-river-side discard-river-left" id="discard-river-3"></div>
        </div>

        <!-- Center -->
        <div class="table-center">
          <div class="remaining-tiles">
            <span id="tiles-remaining">136</span>
            <small>余牌</small>
          </div>
          <div class="round-wind-display" id="round-wind-display">
            <span class="prevailing-wind" id="prevailing-wind">东</span>
            <span class="hand-count" id="hand-count">第1手</span>
          </div>
        </div>

        <!-- Right player (player 1) -->
        <div class="player-area player-right" id="player-right">
          <div class="player-label">
            <span class="player-name" id="name-right">下家</span>
            <span class="player-avatar" id="avatar-right">🦊</span>
            <span class="player-score" id="score-right">25000</span>
            <span class="player-wind" id="wind-right"></span>
            <span class="skill-cooldown" id="cooldown-right"></span>
          </div>
          <div class="hand hand-side" id="hand-right"></div>
          <div class="discard-river discard-river-side discard-river-right" id="discard-river-1"></div>
        </div>
      </div>

      <!-- Bottom player (you, player 0) -->
      <div class="player-area player-bottom" id="player-bottom">
        <div class="discard-river discard-river-bottom" id="discard-river-0"></div>
        <div class="tenpai-indicator" id="tenpai-indicator" style="display:none">
          <span class="tenpai-badge">听</span>
          <div class="tenpai-waiting" id="tenpai-waiting"></div>
        </div>
        <div class="hand hand-bottom" id="hand-bottom"></div>
        <div class="player-label">
          <span class="player-avatar">🎀</span>
          <span class="player-name">我</span>
          <span class="player-score" id="my-score">25000</span>
          <span class="player-wind" id="wind-bottom"></span>
        </div>
      </div>
    </div>
  </div>

  <!-- Shanten badge (shown above player hand) -->
  <div id="shanten-badge" class="shanten-badge" style="display:none"></div>

  <!-- Hint button (standalone, shows during discard phase) -->
  <button id="hint-btn" class="hint-btn-standalone" onclick="HintSystem.getHint()" style="display:none">提示 (3)</button>

  <!-- Action buttons -->
  <div class="action-bar" id="action-bar" style="display:none">
    <button class="action-btn btn-pass" onclick="Game.pass()">过</button>
    <button class="action-btn btn-chi" onclick="Game.chi()" style="display:none">吃</button>
    <button class="action-btn btn-peng" onclick="Game.peng()" style="display:none">碰</button>
    <button class="action-btn btn-gang" onclick="Game.gang()" style="display:none">杠</button>
    <button class="action-btn btn-hu" onclick="Game.hu()" style="display:none">胡!</button>
  </div>

  <!-- Tile counter toggle button -->
  <button id="tile-counter-btn" class="tile-counter-btn" onclick="TileCounter.toggle()" style="display:none">
    <span>统计</span>
  </button>
</div>

<!-- ===== STORY / CAMPAIGN ===== -->
<div id="story" class="page" style="display:none">
  <div class="page-header">
    <h2>📖 麻将物语</h2>
  </div>
  <div id="story-content" class="page-scroll"></div>
</div>

<!-- ===== COLLECTION ===== -->
<div id="collection" class="page" style="display:none">
  <div class="page-header">
    <h2>🎨 收藏</h2>
  </div>
  <div id="collection-content" class="page-scroll"></div>
</div>

<!-- ===== ACHIEVEMENTS ===== -->
<div id="achievements" class="page" style="display:none">
  <div class="page-header">
    <h2>🏆 成就</h2>
  </div>
  <div id="achievements-content" class="page-scroll"></div>
</div>

<!-- ===== TUTORIAL ===== -->
<div id="tutorial" class="page" style="display:none">
  <div class="tutorial-header">
    <button class="icon-btn" onclick="App.backToMenu()">←</button>
    <h2>麻将新手教学</h2>
  </div>
  <div class="tutorial-content" id="tutorial-content">
    <div class="tutorial-step" data-step="1"></div>
    <div class="tutorial-nav">
      <button class="btn-nav" onclick="Tutorial.prev()">上一步</button>
      <span id="tutorial-progress">1/6</span>
      <button class="btn-nav" onclick="Tutorial.next()">下一步</button>
    </div>
  </div>
</div>

<!-- ===== CAMPAIGN GOAL DISPLAY ===== -->
<div id="campaign-goal-bar" class="campaign-goal-bar" style="display:none">
  <span class="campaign-goal-icon">🎯</span>
  <span class="campaign-goal-text" id="campaign-goal-text"></span>
  <span class="campaign-goal-status" id="campaign-goal-status"></span>
</div>

<!-- ===== WIN SCREEN ===== -->
<div id="win-screen" class="modal" style="display:none">
  <div class="modal-content win-content">
    <div class="win-title">🎉 胡牌！</div>
    <div class="win-hand" id="win-hand"></div>
    <div class="win-score" id="win-score"></div>
    <div class="win-fans" id="win-fans"></div>
    <div class="campaign-goal-result" id="campaign-goal-result" style="display:none"></div>
    <button class="menu-btn btn-pink" id="btn-next-hand" onclick="App.nextRound()">下一局</button>
    <button class="menu-btn btn-gray" onclick="App.backToMenu()">返回主页</button>
  </div>
</div>

<!-- ===== MULTI-ROUND SCOREBOARD ===== -->
<div id="round-scoreboard" class="modal" style="display:none">
  <div class="modal-content scoreboard-content">
    <div class="scoreboard-title" id="scoreboard-title">东风圈结束</div>
    <div class="scoreboard-table" id="scoreboard-table"></div>
    <button class="menu-btn btn-pink" onclick="App.startNextRound()">下一圈</button>
    <button class="menu-btn btn-gray" onclick="App.backToMenu()">返回主页</button>
  </div>
</div>

<!-- ===== BOTTOM TAB BAR ===== -->
<div id="tab-bar" class="tab-bar" style="display:none">
  <div class="tab-item active" data-page="home">
    <span class="tab-icon">🏠</span>
    <span class="tab-label">主页</span>
  </div>
  <div class="tab-item" data-page="game">
    <span class="tab-icon">🎮</span>
    <span class="tab-label">对局</span>
  </div>
  <div class="tab-item" data-page="story">
    <span class="tab-icon">📖</span>
    <span class="tab-label">物语</span>
  </div>
  <div class="tab-item" data-page="collection">
    <span class="tab-icon">🎨</span>
    <span class="tab-label">收藏</span>
  </div>
  <div class="tab-item" data-page="achievements">
    <span class="tab-icon">🏆</span>
    <span class="tab-label">成就</span>
  </div>
</div>

<!-- ======================================================
     加载顺序（依赖从上到下）：
     1. 基础工具层（无依赖）
     2. 规则引擎层
     3. 游戏逻辑层
     4. UI / 应用层
     ====================================================== -->

<!-- 1a. 全局配置（常量，无依赖） -->
<script src="js/config.js?v=20260301-3"></script>

<!-- 1b. 牌的定义和工具函数 -->
<script src="js/tiles.js?v=20260301-3"></script>

<!-- 1c. 纯工具模块（依赖 tiles.js / config.js） -->
<script src="js/wall.js?v=20260301-3"></script>
<script src="js/hand.js?v=20260301-3"></script>
<script src="js/meld.js?v=20260301-3"></script>

<!-- 2a. 规则引擎底层 -->
<script src="js/rules-beijing.js?v=20260301-3"></script>
<script src="js/rules-sichuan.js?v=20260301-3"></script>

<!-- 2b. 统一规则适配器（依赖两个规则引擎） -->
<script src="js/rules.js?v=20260301-3"></script>

<!-- 2c. 积分结算（依赖 config.js） -->
<script src="js/scoring.js?v=20260301-3"></script>

<!-- 3a. 存档（依赖 storage.js） -->
<script src="js/storage.js?v=20260301-3"></script>
<script src="js/save.js?v=20260301-3"></script>

<!-- 3b. 角色 / AI -->
<script src="js/characters.js?v=20260301-3"></script>
<script src="js/ai.js?v=20260301-3"></script>
<script src="js/skills.js?v=20260301-3"></script>

<!-- 3c. 解说 -->
<script src="js/commentary.js?v=20260301-3"></script>

<!-- 4a. UI 工具（纯 DOM 工具，renderTile 等） -->
<script src="js/ui.js?v=20260301-3"></script>

<!-- 4b. 核心游戏引擎（依赖上述所有） -->
<script src="js/game.js?v=20260301-3"></script>

<!-- 4c. 应用层（依赖 game.js） -->
<script src="js/campaign.js?v=20260301-3"></script>
<script src="js/stats.js?v=20260301-3"></script>
<script src="js/tutorial.js?v=20260301-3"></script>
<script src="js/enhancements.js?v=20260301-3"></script>
<script src="js/app.js?v=20260301-3"></script>
</body>
</html>
